# 멀티플레이 실행 가이드

## 🎮 멀티플레이 시작 방법

### 방법 1: 호스트 모드 (방 만들기)

1. **게임 실행**
   ```bash
   python main.py
   ```

2. **메인 메뉴에서 "멀티플레이" 선택**
   - 화살표 키(↑↓)로 이동
   - Z 키로 선택

3. **"방 만들기 (호스트)" 선택**
   - 멀티플레이 메뉴에서 첫 번째 옵션 선택

4. **파티 설정**
   - 캐릭터 직업 선택 (중복 불가)
   - 패시브 스킬 설정 (호스트만 가능)

5. **난이도 선택**
   - 원하는 난이도 선택

6. **게임 시작**
   - 호스트 서버가 자동으로 시작됩니다 (포트 5000)
   - 다른 플레이어들이 연결할 수 있습니다

7. **연결 정보 확인**
   - 로그에 서버 주소가 표시됩니다
   - 예: `호스트 서버 시작됨: ws://0.0.0.0:5000`
   - 다른 플레이어들에게 이 IP 주소와 포트 번호를 알려주세요

---

### 방법 2: 클라이언트 모드 (게임 참가)

1. **게임 실행**
   ```bash
   python main.py
   ```

2. **메인 메뉴에서 "멀티플레이" 선택**

3. **"방 참가하기 (클라이언트)" 선택**

4. **호스트 정보 입력**
   - IP 주소 입력 (예: `127.0.0.1` 또는 `192.168.1.100`)
   - 포트 번호 입력 (기본값: `5000`)
   - Tab 키로 IP/포트 전환
   - Enter 키로 연결

5. **연결 대기**
   - 호스트 서버에 연결 시도
   - 연결 성공 시 세션 정보 자동 수신

6. **파티 설정**
   - 캐릭터 직업 선택 (호스트와 중복 불가)
   - 패시브 스킬은 호스트가 설정

7. **게임 시작**
   - 호스트가 게임을 시작하면 자동으로 동기화됩니다
   - 호스트와 같은 던전에서 시작합니다

---

## 📋 멀티플레이 특징

### 호스트
- 게임의 주인 (권한 보유)
- 던전 생성 및 게임 상태 결정
- 패시브 스킬 설정 담당
- 서버 운영 (포트 5000)

### 클라이언트
- 호스트의 게임에 참가
- 실시간으로 게임 상태 동기화
- 독립적으로 캐릭터 이동 가능
- 전투 참가 (주변 플레이어만)

---

## 🔧 네트워크 설정

### 로컬 네트워크 (같은 Wi-Fi)
- 호스트 IP: `192.168.x.x` (호스트 컴퓨터의 로컬 IP)
- 포트: `5000` (기본값)

### 같은 컴퓨터에서 테스트
- IP: `127.0.0.1` 또는 `localhost`
- 포트: `5000`

### IP 주소 확인 방법

**Windows:**
```cmd
ipconfig
```
- IPv4 주소를 찾으세요 (예: `192.168.1.100`)

**Linux/Mac:**
```bash
ifconfig
# 또는
ip addr show
```

---

## ⚙️ 멀티플레이 게임 규칙

### 탐험
- 각 플레이어가 독립적으로 이동
- 적은 2초마다 한 번씩 이동 (호스트가 제어)
- 플레이어 위치 실시간 동기화

### 전투
- **참가 조건**: 전투 시작 지점에서 반경 5타일 내의 플레이어만 참가
- **ATB 시스템**: 
  - 항상 증가 (멈추지 않음)
  - 플레이어가 행동 선택 중일 때: 1/50로 감소
  - 행동 확정 후 1.5초: ATB 정지 (해당 플레이어만)
- **전투 합류**: 진행 중인 전투에 진입 시 자동 참가

### 경험치 및 보상
- 경험치는 참가한 전투원 수로 나뉨
- 인벤토리 공유 (파티 전체)
- 골드 공유 (파티 전체)

### 던전
- 시드 기반 생성 (모든 플레이어가 같은 던전)
- 층 이동 시 동기화

---

## 🐛 문제 해결

### 연결 실패
1. **호스트 서버가 실행 중인지 확인**
   - 호스트가 게임을 시작했는지 확인
   - 로그에 "호스트 서버 시작됨" 메시지 확인

2. **방화벽 확인**
   - Windows 방화벽이 포트 5000을 막지 않는지 확인
   - 호스트 컴퓨터의 방화벽 설정 확인

3. **IP 주소 확인**
   - 로컬 네트워크: 호스트의 로컬 IP 사용 (192.168.x.x)
   - 같은 컴퓨터: `127.0.0.1` 또는 `localhost` 사용

4. **포트 번호 확인**
   - 호스트와 클라이언트가 같은 포트 번호 사용하는지 확인

### 던전 데이터 수신 실패
- 호스트가 게임을 시작하지 않았을 수 있습니다
- 클라이언트는 호스트가 던전을 생성한 후에 연결해야 합니다
- 또는 호스트가 게임을 시작하면 자동으로 던전 데이터가 전송됩니다

### 게임이 동기화되지 않음
- 네트워크 연결 상태 확인
- 호스트와 클라이언트가 모두 같은 세션에 있는지 확인
- 로그를 확인하여 메시지 수신 여부 확인

---

## 💡 팁

1. **테스트**: 같은 컴퓨터에서 여러 게임 인스턴스를 실행하여 테스트할 수 있습니다
   - 첫 번째 창: 호스트 모드
   - 두 번째 창: 클라이언트 모드 (IP: `127.0.0.1`)

2. **로컬 테스트 도구**: `src/multiplayer/test_helper.py`를 사용하여 모의 클라이언트 테스트 가능

3. **포트 변경**: 기본 포트(5000)가 사용 중이면 호스트 코드에서 포트 번호 변경 가능

---

**더 자세한 정보는 `docs/multiplayer_p2p_detailed.md`를 참고하세요.**

