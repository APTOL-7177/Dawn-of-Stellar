# 직업별 필드 스킬 (Field Skills) 전체 기획

## 1. 개요
*   **발동 키**: `F` (탐험 모드)
*   **UI**: 파티원 선택 팝업 → 스킬 사용
*   **공통 조건**: 탐험 상태(비전투), MP 소모
*   **목표**: 33개 모든 직업에 대해 고유하고 구현 가능한 유틸리티 제공

---

## 2. 33개 직업별 필드 스킬 상세 목록

### [근접/전사 계열]
| 직업 | 스킬명 | 효과 상세 | MP | 구현 로직 |
| :--- | :--- | :--- | :--- | :--- |
| **전사** | **강철 체력** | 비전투 중 HP를 즉시 30% 회복하지만, 10턴간 이동 속도가 느려짐(SLOW 상태). | 20 | `heal()`, `add_status(SLOW)` |
| **검투사** | **투지** | 현재 HP를 10% 소모하여 MP를 30 회복. (전투 준비용) | 0 | `damage()`, `restore_mp()` |
| **기사** | **방비 태세** | 파티 전체에 20턴간 `DEF_UP` 버프 부여. | 25 | 파티 루프 `add_status(BOOST_DEF)` |
| **성기사** | **신성한 빛** | 파티원 전체 HP 15% 회복 및 `CURSE`(저주) 상태 제거. | 40 | `heal()`, `remove_status(CURSE)` |
| **암흑기사** | **어둠의 계약** | 자신의 HP 절반을 소모하여 다음 1회의 전투 데미지를 2배로 만듦(`STRENGTHEN` 버프). | 10 | `current_hp //= 2`, `add_status(STRENGTHEN)` |
| **광전사** | **분노 축적** | HP 20 소모, 다음 전투 시작 시 `RAGE`(공격력 대폭 상승) 상태로 시작. | 10 | `take_damage(20)`, `add_status(RAGE)` |
| **용기사** | **용의 비늘** | 30턴간 파티원 전체에게 화염 저항(`FIRE_SHIELD`) 상태 부여. | 30 | `add_status(FIRE_SHIELD)` |
| **검성** | **심안** | 주변 5칸 이내의 적 위치를 감지하고 `ACCURACY_UP` 상태 획득. | 20 | 적 위치 핑, `add_status(BOOST_ACCURACY)` |
| **사무라이** | **명상** | 제자리에서 1턴 대기하며 MP 15% 회복 및 `FOCUS`(치명타율 증가) 상태 획득. | 0 | `restore_mp()`, `add_status(FOCUS)` |
| **브레이커** | **파쇄** | **(확정)** 전방의 `WALL`이나 `DOOR`를 `FLOOR`로 파괴. (경계벽 제외) | 15 | 타일 타입 변경 (`WALL` -> `FLOOR`) |
| **마검사** | **마력 변환** | 현재 MP를 모두 소모하여, 소모한 양의 2배만큼 HP 회복. | All | `heal(mp * 2)`, `mp = 0` |

### [마법/지원 계열]
| 직업 | 스킬명 | 효과 상세 | MP | 구현 로직 |
| :--- | :--- | :--- | :--- | :--- |
| **아크메이지**| **마나 감지** | 현재 층의 `CHEST`, `CRYSTAL`, `SHRINE` 위치를 맵에 표시. | 20 | 해당 타일 `explored = True` 처리 |
| **정령술사** | **자연의 보호** | 파티원 전체에게 랜덤한 원소 보호막(`FIRE/ICE/SHADOW_SHIELD`) 중 하나 부여. | 30 | 랜덤 선택 후 `add_status()` |
| **시간술사** | **시간 역행** | 사용 시점의 위치를 기억했다가, 다시 사용하면 그 위치로 텔레포트 (같은 층 내). | 50 | `saved_pos` 변수에 좌표 저장/이동 |
| **차원술사** | **위상 이동** | 무작위 위치로 텔레포트 (위험 탈출용). | 30 | `teleport_randomly()` |
| **네크로맨서**| **생명 흡수** | 주변(3칸)에 적이 있을 때, 적 체력을 10 깎고 자신 HP 10 회복. | 15 | 적 검색 후 `damage`, `heal` |
| **배틀메이지**| **마력 보호막** | 30턴간 자신에게 `MANA_SHIELD`(피격 시 MP로 데미지 대신 받음) 부여. | 20 | `add_status(MANA_SHIELD)` |
| **바드** | **행진곡** | 50턴간 파티 전체 이동 속도 증가 (`HASTE`). | 30 | `add_status(HASTE)` |
| **신관** | **축복** | 파티원 1명(선택)의 모든 디버프 제거 및 HP 완전 회복. | 60 | `heal(max)`, `clear_debuffs()` |
| **성직자** | **치유의 기도**| 파티 전체 HP 20% 회복. | 30 | 파티 전체 `heal_percent(20)` |
| **드루이드** | **자연의 정화**| 파티 전체의 `POISON`, `DISEASE` 상태 제거 및 소량 회복. | 25 | `remove_status(POISON/DISEASE)` |
| **무당** | **혼령 정찰** | **(확정)** 현재 위치 기준 반경 8칸의 시야를 즉시 밝힘. | 20 | `fov.compute_fov(radius=8)` |

### [기술/민첩 계열]
| 직업 | 스킬명 | 효과 상세 | MP | 구현 로직 |
| :--- | :--- | :--- | :--- | :--- |
| **궁수** | **매의 눈** | 50턴간 시야 범위 +2 증가 버프 부여. | 15 | `vision_bonus += 2` 효과 적용 |
| **저격수** | **위장** | 30턴간 적에게 발각되지 않는 `STEALTH` 상태 부여. (공격/이동 시 해제 안됨) | 25 | `add_status(STEALTH)` |
| **도적** | **자물쇠 따기**| 인접한 `LOCKED_DOOR`나 `CHEST`를 열쇠 없이 즉시 염. | 10 | `tile.unlock()` 호출 |
| **암살자** | **독 바르기** | 다음 전투 첫 공격 시 적에게 강력한 `POISON`을 거는 상태 부여. | 20 | `add_status(POISON_WEAPON)` |
| **해적** | **약탈 감각** | 맵에 떨어진 `GOLD`, `ITEM`의 위치를 모두 밝힘. | 10 | 아이템 타일 `explored = True` |
| **기계공학자**| **함정 해체** | 주변 5칸 이내의 모든 `TRAP`을 안전한 `FLOOR`로 변경. | 15 | 범위 내 타일 검사 및 변경 |
| **해커** | **시스템 해킹**| 맵 전체의 잠긴 문(`LOCKED_DOOR`)을 일괄 해제하거나 `ROBOT` 계열 적을 정지(`STUN`) 시킴. | 40 | 전체 타일 스캔 및 `unlock()` |
| **연금술사** | **포션 제조** | 빈 병이 있다면 `HP Potion` 1개 생성. (확률적으로 실패 가능) | 30 | 인벤토리에 아이템 추가 |
| **몽크** | **내공** | 자신의 모든 상태이상 제거 및 MP 20 회복. | 10 | `clear_status()`, `restore_mp(20)` |
| **철학자** | **통찰** | 현재 층의 `BOSS_ROOM` 또는 `STAIRS_DOWN` 위치를 밝힘. | 25 | 특정 타일 좌표 찾아서 밝힘 |
| **뱀파이어** | **수혈** | **(확정)** 자신 HP 20 소모 -> 선택한 아군 HP 50 회복. | 10 | `damage(self)`, `heal(target)` |

---

## 3. 구현 구조 (Architecture)

### 3.1. FieldSkillManager
*   별도의 복잡한 클래스 상속 대신, `Dictionary` 기반으로 스킬 정보를 관리하여 확장성을 높입니다.
*   `src/world/field_skills.py` 파일 하나에 모든 로직을 집약합니다.

### 3.2. 실행 프로세스
1.  **입력 감지 (`WorldUI.handle_input`)**: `F` 키 입력.
2.  **UI 표시 (`FieldSkillPopup`)**:
    *   현재 파티원 리스트를 `CursorMenu`로 표시.
    *   각 파티원의 직업에 맞는 스킬 이름과 MP 소모량 표시.
    *   MP 부족 시 빨간색 표시 및 선택 불가.
3.  **스킬 실행 (`FieldSkillManager.use_skill`)**:
    *   선택된 캐릭터와 스킬 ID 전달.
    *   MP 소모 처리.
    *   각 스킬별 함수(`_skill_breaker_smash` 등) 실행.
    *   결과 메시지 반환.
4.  **피드백**: 성공/실패 메시지 출력 및 턴 소모(옵션).

## 4. 데이터 추가
기존 캐릭터 YAML 파일에 `field_skill_id` 필드를 추가하는 것이 정석이나,
현재 빠른 구현을 위해 **코드 내 매핑 테이블**(`CLASS_SKILL_MAP`)을 우선 사용합니다.
(추후 YAML로 이관 가능)

```python
# src/world/field_skills.py 예시

CLASS_SKILL_MAP = {
    "warrior": "iron_will",
    "breaker": "smash",
    "shaman": "spirit_scout",
    "vampire": "transfusion",
    # ... 33개 직업 매핑
}
```
