@echo off
chcp 65001 > nul
setlocal EnableDelayedExpansion

:: ====================================================================
:: Dawn of Stellar - ì™„ì „ ìžë™ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ (Python í¬í•¨)
:: Pythonì´ ì—†ì–´ë„ ìžë™ìœ¼ë¡œ ì„¤ì¹˜í•˜ê³  ê²Œìž„ì„ ì‹¤í–‰í•©ë‹ˆë‹¤
:: ====================================================================

title Dawn of Stellar ìžë™ ì„¤ì¹˜ê¸°

color 0A
cls

echo.
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘                                                               â•‘
echo â•‘     â­ Dawn of Stellar (ë³„ë¹›ì˜ ì—¬ëª…) â­                      â•‘
echo â•‘                                                               â•‘
echo â•‘              ì™„ì „ ìžë™ ì„¤ì¹˜ í”„ë¡œê·¸ëž¨                         â•‘
echo â•‘                                                               â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo    Final Fantasy ìŠ¤íƒ€ì¼ ë¡œê·¸ë¼ì´í¬ RPG
echo    28ê°œ ì§ì—… Ã— ATB ì „íˆ¬ Ã— AI ë™ë£Œ ì‹œìŠ¤í…œ
echo.
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo    ðŸ“Œ ì´ ì„¤ì¹˜ê¸°ëŠ” Pythonì´ ì—†ì–´ë„ ìžë™ìœ¼ë¡œ ì„¤ì¹˜í•©ë‹ˆë‹¤!
echo.
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

timeout /t 2 /nobreak >nul

:: ====================================================================
:: ê´€ë¦¬ìž ê¶Œí•œ í™•ì¸
:: ====================================================================

echo [í™•ì¸] ê´€ë¦¬ìž ê¶Œí•œ ì²´í¬...
net session >nul 2>&1
if %errorlevel% neq 0 (
    echo.
    echo âš ï¸  ì´ ì„¤ì¹˜ í”„ë¡œê·¸ëž¨ì€ ê´€ë¦¬ìž ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.
    echo.
    echo ðŸ“Œ í•´ê²° ë°©ë²•:
    echo    ìš°í´ë¦­ ^> "ê´€ë¦¬ìž ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰"ì„ ì„ íƒí•˜ì„¸ìš”.
    echo.
    pause
    exit /b 1
)
echo âœ… ê´€ë¦¬ìž ê¶Œí•œ í™•ì¸ë¨
echo.

:: ====================================================================
:: Python ì„¤ì¹˜ í™•ì¸ ë° ìžë™ ì„¤ì¹˜
:: ====================================================================

echo [1/6] Python í™•ì¸ ì¤‘...
echo.

python --version >nul 2>&1
if %errorlevel% neq 0 (
    echo âš ï¸  Pythonì´ ì„¤ì¹˜ë˜ì–´ ìžˆì§€ ì•ŠìŠµë‹ˆë‹¤.
    echo.
    echo ðŸ“¥ Python 3.11ì„ ìžë™ìœ¼ë¡œ ì„¤ì¹˜í•©ë‹ˆë‹¤...
    echo.

    :: Python ì„¤ì¹˜ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
    set PYTHON_URL=https://www.python.org/ftp/python/3.11.9/python-3.11.9-amd64.exe
    set PYTHON_INSTALLER=python-installer.exe

    echo    ë‹¤ìš´ë¡œë“œ ì¤‘... (ì•½ 25MB)
    echo    URL: %PYTHON_URL%
    echo.

    :: PowerShellë¡œ ë‹¤ìš´ë¡œë“œ
    powershell -Command "& {[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12; Invoke-WebRequest -Uri '%PYTHON_URL%' -OutFile '%PYTHON_INSTALLER%'}"

    if not exist %PYTHON_INSTALLER% (
        echo.
        echo âŒ Python ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨!
        echo.
        echo ðŸ“Œ ìˆ˜ë™ ì„¤ì¹˜ ë°©ë²•:
        echo    1. https://www.python.org/downloads/ ë°©ë¬¸
        echo    2. Python 3.11 ì´ìƒ ë‹¤ìš´ë¡œë“œ ë° ì„¤ì¹˜
        echo    3. ì„¤ì¹˜ ì‹œ "Add Python to PATH" ì²´í¬!
        echo    4. ì´ ìŠ¤í¬ë¦½íŠ¸ ë‹¤ì‹œ ì‹¤í–‰
        echo.
        pause
        exit /b 1
    )

    echo âœ… ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!
    echo.
    echo ðŸ“¦ Python ì„¤ì¹˜ ì¤‘... (2-3ë¶„ ì†Œìš”)
    echo    ì„¤ì¹˜ ì°½ì´ ë‚˜íƒ€ë‚˜ë©´ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...
    echo.

    :: Python ìžë™ ì„¤ì¹˜ (silent mode)
    %PYTHON_INSTALLER% /quiet InstallAllUsers=1 PrependPath=1 Include_test=0

    :: ì„¤ì¹˜ ì™„ë£Œ ëŒ€ê¸°
    timeout /t 5 /nobreak >nul

    :: ì„¤ì¹˜ íŒŒì¼ ì‚­ì œ
    del %PYTHON_INSTALLER% >nul 2>&1

    :: PATH ìƒˆë¡œê³ ì¹¨ (í™˜ê²½ë³€ìˆ˜ ë‹¤ì‹œ ë¡œë“œ)
    call :RefreshEnv

    :: Python ìž¬í™•ì¸
    python --version >nul 2>&1
    if %errorlevel% neq 0 (
        echo.
        echo âš ï¸  Python ì„¤ì¹˜ëŠ” ì™„ë£Œë˜ì—ˆìœ¼ë‚˜ PATH ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.
        echo.
        echo ðŸ“Œ í•´ê²° ë°©ë²•:
        echo    1. ì»´í“¨í„°ë¥¼ ìž¬ë¶€íŒ…í•˜ê±°ë‚˜
        echo    2. ìƒˆ ëª…ë ¹ í”„ë¡¬í”„íŠ¸ ì°½ì—ì„œ ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ì„¸ìš”.
        echo.
        pause
        exit /b 1
    )

    echo âœ… Python ì„¤ì¹˜ ì™„ë£Œ!
    echo.
) else (
    for /f "tokens=2" %%i in ('python --version 2^>^&1') do set PYTHON_VERSION=%%i
    echo âœ… Python !PYTHON_VERSION! ì´ë¯¸ ì„¤ì¹˜ë¨
    echo.
)

:: ====================================================================
:: 2ë‹¨ê³„: pip ì—…ê·¸ë ˆì´ë“œ
:: ====================================================================

echo [2/6] pip ì—…ê·¸ë ˆì´ë“œ ì¤‘...
echo.

python -m pip install --upgrade pip --quiet
if %errorlevel% neq 0 (
    echo âš ï¸  pip ì—…ê·¸ë ˆì´ë“œ ì‹¤íŒ¨ (ë¬´ì‹œí•˜ê³  ê³„ì†...)
) else (
    echo âœ… pip ì—…ê·¸ë ˆì´ë“œ ì™„ë£Œ!
)
echo.

:: ====================================================================
:: 3ë‹¨ê³„: ê²Œìž„ ì˜ì¡´ì„± ì„¤ì¹˜
:: ====================================================================

echo [3/6] ê²Œìž„ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì¤‘...
echo.
echo    í•„ìˆ˜ íŒ¨í‚¤ì§€: TCOD, PyYAML, NumPy
echo    ì‹œê°„ì´ ë‹¤ì†Œ ê±¸ë¦´ ìˆ˜ ìžˆìŠµë‹ˆë‹¤...
echo.

python -m pip install -r requirements-minimal.txt
if %errorlevel% neq 0 (
    echo.
    echo âŒ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì‹¤íŒ¨!
    echo.
    echo ðŸ“Œ í•´ê²° ë°©ë²•:
    echo    1. ì¸í„°ë„· ì—°ê²° í™•ì¸
    echo    2. ë°©í™”ë²½/ë°±ì‹  í”„ë¡œê·¸ëž¨ í™•ì¸
    echo    3. ìˆ˜ë™ ì„¤ì¹˜: python -m pip install tcod pyyaml numpy
    echo.
    pause
    exit /b 1
)

echo.
echo âœ… ëª¨ë“  íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì™„ë£Œ!
echo.

:: ====================================================================
:: 4ë‹¨ê³„: ê²Œìž„ íŒŒì¼ í™•ì¸
:: ====================================================================

echo [4/6] ê²Œìž„ íŒŒì¼ í™•ì¸ ì¤‘...
echo.

if not exist "main.py" (
    echo âŒ main.py íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!
    echo.
    echo    í˜„ìž¬ ìœ„ì¹˜: %CD%
    echo.
    echo ðŸ“Œ ì´ ë°°ì¹˜íŒŒì¼ì„ ê²Œìž„ í´ë”ì— ìœ„ì¹˜ì‹œì¼œì£¼ì„¸ìš”.
    echo.
    pause
    exit /b 1
)

if not exist "src" (
    echo âŒ src í´ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!
    echo.
    pause
    exit /b 1
)

echo âœ… ê²Œìž„ íŒŒì¼ í™•ì¸ ì™„ë£Œ!
echo.

:: ====================================================================
:: 5ë‹¨ê³„: ì„¤ì¹˜ ê²€ì¦
:: ====================================================================

echo [5/6] ì„¤ì¹˜ ê²€ì¦ ì¤‘...
echo.

python -c "import tcod, yaml, numpy; print('âœ… ëª¨ë“  í•„ìˆ˜ ëª¨ë“ˆ ë¡œë“œ ì„±ê³µ')" 2>nul
if %errorlevel% neq 0 (
    echo âŒ ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨
    echo.
    echo ì„¤ì¹˜ëœ íŒ¨í‚¤ì§€ í™•ì¸:
    python -m pip list | findstr "tcod yaml numpy"
    echo.
    pause
    exit /b 1
)

echo âœ… ì„¤ì¹˜ ê²€ì¦ ì™„ë£Œ!
echo.

:: ====================================================================
:: 6ë‹¨ê³„: ë°”ë¡œê°€ê¸° ìƒì„±
:: ====================================================================

echo [6/6] ë°”ë¡œê°€ê¸° ìƒì„± ì¤‘...
echo.

:: run.bat íŒŒì¼ì´ ì—†ìœ¼ë©´ ìƒì„±
if not exist "run.bat" (
    echo @echo off > run.bat
    echo title Dawn of Stellar >> run.bat
    echo python main.py >> run.bat
    echo pause >> run.bat
    echo âœ… run.bat ìƒì„± ì™„ë£Œ
) else (
    echo âœ… run.bat ì´ë¯¸ ì¡´ìž¬í•¨
)
echo.

:: ====================================================================
:: ì„¤ì¹˜ ì™„ë£Œ!
:: ====================================================================

cls
color 0E

echo.
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘                                                               â•‘
echo â•‘            ðŸŽ‰ ì„¤ì¹˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ðŸŽ‰                     â•‘
echo â•‘                                                               â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo    ðŸŽ® ê²Œìž„ ì‹¤í–‰ ë°©ë²•:
echo.
echo       1. run.bat íŒŒì¼ì„ ë”ë¸”í´ë¦­
echo       2. ë˜ëŠ” ëª…ë ¹ì–´: python main.py
echo.
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo.
echo    ðŸ› ï¸  ì¶”ê°€ ì˜µì…˜:
echo.
echo       ê°œë°œ ëª¨ë“œ (ëª¨ë“  ì§ì—… ìž ê¸ˆ í•´ì œ):
echo       python main.py --dev
echo.
echo       ë””ë²„ê·¸ ëª¨ë“œ (ìƒì„¸ ë¡œê·¸):
echo       python main.py --debug --log=DEBUG
echo.
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

:: ====================================================================
:: ì¦‰ì‹œ ì‹¤í–‰ ì˜µì…˜
:: ====================================================================

echo.
set /p RUN_NOW="ì§€ê¸ˆ ë°”ë¡œ ê²Œìž„ì„ ì‹œìž‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (Y/N): "
echo.

if /i "%RUN_NOW%"=="Y" (
    echo ðŸŽ® ê²Œìž„ì„ ì‹œìž‘í•©ë‹ˆë‹¤...
    echo.
    timeout /t 2 /nobreak >nul

    :: ê²Œìž„ ì‹¤í–‰
    python main.py

    if %errorlevel% neq 0 (
        echo.
        echo âš ï¸  ê²Œìž„ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
        echo.
        echo ðŸ“Œ ë¡œê·¸ íŒŒì¼ì„ í™•ì¸í•˜ì„¸ìš”: logs/
        echo.
        pause
    )
) else (
    echo.
    echo ðŸ‘‹ ë‚˜ì¤‘ì— run.batì„ ì‹¤í–‰í•˜ì—¬ ê²Œìž„ì„ ì¦ê¸°ì„¸ìš”!
    echo.
)

echo.
echo ì„¤ì¹˜ í”„ë¡œê·¸ëž¨ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.
echo.
timeout /t 3
exit /b 0

:: ====================================================================
:: í•¨ìˆ˜: í™˜ê²½ë³€ìˆ˜ ìƒˆë¡œê³ ì¹¨
:: ====================================================================
:RefreshEnv
:: PATH í™˜ê²½ë³€ìˆ˜ë¥¼ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì—ì„œ ë‹¤ì‹œ ì½ì–´ì˜´
for /f "tokens=2*" %%a in ('reg query "HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Environment" /v PATH 2^>nul') do set "SYS_PATH=%%b"
for /f "tokens=2*" %%a in ('reg query "HKCU\Environment" /v PATH 2^>nul') do set "USER_PATH=%%b"
set "PATH=%SYS_PATH%;%USER_PATH%"
goto :eof
